<html>

<head>
    <title>The Ebook Hub</title>
    <link rel="stylesheet" href="sources/stylesheet.css" />
    <link rel="stylesheet" href="CSS/bewertungen.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="JS/sessionHandling.js"></script>
    <meta charset="UTF-8" />
</head>

<body>
    <div id="navigation">
        <div id="titel" class="navElemente">
            <a id="title_font" href="Home.html">The Ebook Hub</a>
        </div>

        <div id="selectNav" class="navElemente">
            <a href="Home.html">HOME</a>
            <a href="Shop.html">SHOP</a>
            <a href="AuthorPageUebersicht.html">AUTOREN</a>
            <a href="Profil.html">ACCOUNT</a>        
            <a href="Warenkorb.html">
            <img id="warenkorb" src="sources/Warenkorb.png" alt="Warenkorb">
            <span id="anzahl_bestellungen"></span>
            </a>
        </div>

        <div id="logo"></div>
    </div>

    <div id="main">
        <div id="beschreibung">
            <h1>Bewertungen</h1>
        </div>       
        <div id="first">
        </div>
        <div id="second">
            <div id="rating">
                <p class="headline">Inhalt</p>
                <div class="stars">
                    <span class="fa fa-star star_inhalt checked_star" onmouseover="markStars(1,'star_inhalt'); calcAvgStars(); "></span>
                    <span class="fa fa-star star_inhalt " onmouseover="markStars(2,'star_inhalt'); calcAvgStars();"></span>
                    <span class="fa fa-star star_inhalt" onmouseover="markStars(3,'star_inhalt'); calcAvgStars();"></span>
                    <span class="fa fa-star star_inhalt" onmouseover="markStars(4,'star_inhalt'); calcAvgStars();"></span>
                    <span class="fa fa-star star_inhalt" onmouseover="markStars(5,'star_inhalt'); calcAvgStars();"></span>
                </div>

                <p class="headline">Stil</p>
                <div class="stars">
                    <span class="fa fa-star star_stil checked_star" onmouseover="markStars(1,'star_stil'); calcAvgStars();"></span>
                    <span class="fa fa-star star_stil" onmouseover="markStars(2,'star_stil'); calcAvgStars();"></span>
                    <span class="fa fa-star star_stil" onmouseover="markStars(3,'star_stil'); calcAvgStars();"></span>
                    <span class="fa fa-star star_stil" onmouseover="markStars(4,'star_stil'); calcAvgStars();"></span>
                    <span class="fa fa-star star_stil" onmouseover="markStars(5,'star_stil'); calcAvgStars();"></span>
                </div>
                <p class="headline">Umfang</p>
                <div class="stars">
                    <span class="fa fa-star star_umfang checked_star" onmouseover="markStars(1,'star_umfang'); calcAvgStars();"></span>
                    <span class="fa fa-star star_umfang" onmouseover="markStars(2,'star_umfang'); calcAvgStars();"></span>
                    <span class="fa fa-star star_umfang" onmouseover="markStars(3,'star_umfang'); calcAvgStars();"></span>
                    <span class="fa fa-star star_umfang" onmouseover="markStars(4,'star_umfang'); calcAvgStars();"></span>
                    <span class="fa fa-star star_umfang" onmouseover="markStars(5,'star_umfang'); calcAvgStars();"></span>
                </div>
                <p class="headline">Gesamt</p>
                <div class="stars">
                    <span class="fa fa-star star_gesamt checked_star"></span>
                    <span class="fa fa-star star_gesamt"></span>
                    <span class="fa fa-star star_gesamt"></span>
                    <span class="fa fa-star star_gesamt"></span>
                    <span class="fa fa-star star_gesamt"></span>
                </div>
            </div>
            <div id="select_and_confirm">
                <div id="confirm_container">
                    <form method="GET" action="">
                        <button onclick="submit_stars();" type="submit" id="confirm">Absenden</button>
                    </form>
                </div>                
            </div>
        </div>
    </div>

    <div id="footer">
        <div id="selectFooter" class="FooterElemente">
            <a href="Impressum.html">Impressum und Kontakt</a>
            <a href="Datenschutzerklaerung.html">Datenschutz</a>
            <a href="Widerrufsrecht.html">Widerrufsrecht</a>
        </div>
        <div id="copyright"></div>
    </div>

    <script>
        $(async () => {
            await loadWarenkorb();
            let book_id = await getUrlParameterByName("titelID");
            let book = await loadBook(book_id);
            console.log(book);
            await ajaxToHTML(book);
        });

        async function loadBook(id) {
            let response = await fetch("http://localhost:8000/web2/buch/gib/" + id);
			let json_book = await response.json();
			return json_book.daten;
        }


        function ajaxToHTML(book) {
            //tmp = "<div id=\"Buch_img\">";
            tmp = "<img class=\"img_Buch\" src=\"" + book.bildpfad + "\" alt=\"book_image\"/>";
            //tmp += "</div>";
            tmp += "<table>";
            tmp += "<tr>";
            tmp += "<th>Titel:</th>";
            tmp += "<td>" + book.titel + "</td>";
            tmp += "</tr>";
            tmp += "<tr>";
            tmp += "<th>Autor:</th>";
            tmp += "<td>" + book.autor + "</td>";
            tmp += "</tr>";
            tmp += "<tr>";
            tmp += "<th>Erscheinungsjahr:</th>";
            tmp += "<td>" + book.erscheinungsjahr + "</td>";
            tmp += "</tr>";
            tmp += "</table>";
            $("#first").append(tmp);
        }

        function getUrlParameterByName(name,url) {
			if (!url) url = window.location.href;
			name = name.replace(/[\[\]]/g, "\\$&");
			var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"), results = regex.exec(url);
			if (!results) return null;
			if (!results[2]) return '';
			return decodeURIComponent(results[2].replace(/\+/g, " "));
		}


        function markStars(number,star_class){
            let stars=document.getElementsByClassName(star_class);
            for(let i=0;i<number;i++){
                stars[i].classList.add("checked_star");
            }
            for(let i=number; i<stars.length;i++){
                stars[i].classList.remove("checked_star");
            }
        }

        function calcAvgStars(){
            let avg = Math.round((document.getElementsByClassName("star_inhalt checked_star").length + document.getElementsByClassName("star_stil checked_star").length + document.getElementsByClassName("star_umfang checked_star").length) / 3);
            markStars(avg,'star_gesamt');
        }

        function submit_stars(){
            //BACKEND MUSS ÜBERPRÜFEN RATING JEWEILS ZWISCHEN 1 UND 5 STERNEN IST!
            console.log("Inhalt: " + document.getElementsByClassName("star_inhalt checked_star").length);
            console.log("Stil: " + document.getElementsByClassName("star_stil checked_star").length);
            console.log("Umfang: " + document.getElementsByClassName("star_stil checked_star").length);
            //Backend muss eh überprüfen also macht es kein Sinn "Gesamt" mitzugeben.
        }
    </script>
</body>

</html>