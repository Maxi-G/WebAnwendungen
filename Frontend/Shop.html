<html>
    <head>
        <title>The Ebook Hub</title>
        <link rel="stylesheet" href="CSS/shop_stylesheet.css"/>
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
        <meta charset="UTF-8"/>
    </head>
    
    <body>
        <div id="navigation">
            <div id="titel" class="navElemente">
                <a id="title_font" href="Home.html">The Ebook Hub</a>
            </div>

            <div id="selectNav" class="navElemente">              
                    <a href="Home.html">HOME</a>     
                    <a href="Shop.html">SHOP</a>   
                    <a href="AuthorPageÜbersicht.html">AUTOREN</a>          
                    <a href="Warenkorb.html">
                    <img id="warenkorb" src="sources/Warenkorb.png" alt="Warenkorb">
                    </a>                 
            </div>

            <div id="logo"></div>
        </div>   
        
        <div class="shop_body_container" id="shop_container">
			<h1 id="shop_headline">Shop-Übersicht</h1>
		
		
		
			<div class="Left_container" id="l_container">

				<div id="filter_box">

					<p>Alle Bücher:</p>
				
					
					
					<p class="filter_hover" onclick="show_cat()"><span id="span_cat">&#8722;</span> Kategorien:</p>
					<div id="cat">
					
						<form>
				
						<div class="elements">
							<input name="cat_1" type="checkbox" id="Fantasy" color="orange"> 
							<label for="Fantasy">Fantasy</label>

						</div>

						<div class="elements">
							<input name="cat_2" type="checkbox" id="Horror"> 
							<label for="Horror">Horror</label>

						</div>

						<div class="elements">
							<input name="cat_3" type="checkbox" id="Humor"> 
							<label for="Humor">Humor</label>

						</div>

						<div class="elements">
							<input name="cat_4" type="checkbox" id="Krimi"> 
							<label for="Krimi">Krimi</label>

						</div>

						<div class="elements">
							<input name="cat_5" type="checkbox" id="Ratgeber"> 
							<label for="Ratgeber">Ratgeber</label>

						</div>

						<div class="elements">
							<input name="cat_6" type="checkbox" name="r" id="Roman"> 
							<label for="Roman">Roman</label>

						</div>

						<div class="elements">
							<input name="cat_7" type="checkbox" id="Sachbücher"> 
							<label for="Sachbücher">Sachbücher</label>

						</div>

						<div class="elements">
							<input name="cat_8" type="checkbox" id="Thriller"> 
							<label for="Thriller">Thriller</label>

						</div>
						
					
					</div>
					
					
					

					
						
						<p class="filter_hover" onclick="show_price_slider()"><span id="span_price">&minus;</span> Preis:</p>
						<div id="Price_box">
							
							<!--<div onclick="function_plus()" class="plus">+</div>-->

							<div class="plus filter_hover"><span onclick="function_plus()">&plus;</span></div>


							<div class="minus filter_hover"><span onclick="function_minus()">&minus;</span></div>

							<!--<div onclick="function_minus()" class="minus">-</div>-->

							<!-- <div class="slidecontainer">
								<p class="Space"><input type="range" min="1" max="120" value="60" class="slider" id="myRange">
								0&#8364; <span id="demo"></span>&#8364; 120&#8364;</p>
							</div> -->

							<div class="slidecontainer">
								<input name="price" type="range" min="1" max="120" value="60" class="slider" id="myRange">
								<p>
								<span id="Space1">0&#8364;</span> <span id="demo"></span><span>&#8364;</span> <span id="Space2">120&#8364;</span>
								</p>
							</div>

						</div>
					


					
					
					<p class="filter_hover" onclick="show_ratings()"><span id="span_rating">&minus;</span> Bewertungen:</p>

					<div class = "Bewertungen" id="Rating_box">
						 
						
						
						<p><input name="rating_1s" type="checkbox" id="1Sterne">
						<span class="fa fa-star checked_star"></span>
						<span class="fa fa-star"></span>
						<span class="fa fa-star"></span>
						<span class="fa fa-star"></span>
						<span class="fa fa-star"></span></p>

						<p></p><input name="rating_2s" type="checkbox" id="2Sterne">
						<span class="fa fa-star checked_star"></span>
						<span class="fa fa-star checked_star"></span>
						<span class="fa fa-star"></span>
						<span class="fa fa-star"></span>
						<span class="fa fa-star"></span></p>


						<p></p><input name="rating_3s" type="checkbox" id="3Sterne"><span class="fa fa-star checked_star"></span>
						<span class="fa fa-star checked_star"></span>
						<span class="fa fa-star checked_star"></span>
						<span class="fa fa-star"></span>
						<span class="fa fa-star"></span></p>


						<p></p><input name="rating_4s" type="checkbox" id="4Sterne"><span class="fa fa-star checked_star"></span>
						<span class="fa fa-star checked_star"></span>
						<span class="fa fa-star checked_star"></span>
						<span class="fa fa-star checked_star"></span>
						<span class="fa fa-star"></span></p>


						<p></p><input name="rating_5s" type="checkbox" id="5Sterne"><span class="fa fa-star checked_star"></span>
						<span class="fa fa-star checked_star"></span>
						<span class="fa fa-star checked_star"></span>
						<span class="fa fa-star checked_star"></span>
						<span class="fa fa-star checked_star"></span></p>

						
						
						

					</div>
					
						<input type="submit" value="submit"></input>

					</form>

					
				</div>
			
			</div>
			
			<form class="searchbar_container">
				<input type="text" placeholder="Nach Titel, Autor oder ISBN suchen..." name="search">
				<button type="submit" >	<i class="fa fa-search"> </i>	</button>
			</form>
		
			
			
			

			
		</div>
		
		<script src="JS/shop.js"></script>

		<div class="Footer_div">
        <div id="footer">
            <div id="selectFooter" class="FooterElemente">              
                <a href="Impressum.html">Impressum und Kontakt</a>     
                <a href="Datenschutzerklärung.html">Datenschutz</a>   
                <a href="Widerrufsrecht.html">Widerrufsrecht</a>     
            </div>
            <div id="copyright"></div>
        </div>
		</div>



		<script>
			var ajaxBooks;
			var ajaxBookpics=[];
			var ajaxAuthors=[];
			var ajaxGenres=[];

			
			function createStars(num){
				var ratingString = "<div class=\"rating_container\">";
				num = Math.round(num);
				for(j=0;j<5;j++){
					if(j<num){
						ratingString += "<span class=\"fa fa-star checked_star\"></span>";
					}
					else{
						ratingString+= "<span class=\"fa fa-star\"></span>";
					}
				}
				ratingString+="</div>";
				return ratingString;
			}

			

			

			function ajax_safeAllBooks(value){
				ajaxBooks=value;
				// CALL additional ajax to get required data.
				ajax_safePicsToBooks(value);
				ajax_safeAuthorToBooks(value);
				ajax_safeGenreToBooks(value);
			}

			
			function ajax_safeAdditionalData(value, mode){      // mode = 0 --> speicher Bild         mode = 1 --> speicher Autor     mode = 2 --> speicher genre
				switch(mode){
					case 0:
						ajaxBookpics.push(value.daten);
						break;
					case 1:
						ajaxAuthors.push(value.daten);
						break;
					case 2:
						ajaxGenres.push(value.daten);
						break;
				}

				// WIRD BENÖTIGT WEGEN ASYNC.
				if(ajaxBookpics.length == ajaxBooks.length && ajaxAuthors.length == ajaxBooks.length && ajaxGenres.length == ajaxBooks.length){
					console.log(ajaxGenres);
					ajaxToHTML();
				}
			}
			
			

		

			function ajax_safePicsToBooks(Books_Json){
				for (i = 0; i <= Books_Json.length-1; i++) {
					obj = Books_Json[i];
					$.ajax({
               			url: 'http://localhost:8000/web2/buchbild/gib/' + obj.bildid ,
                		method: 'get',
                		dataType: 'json'
            		}).done(function (response) {

						ajax_safeAdditionalData(response,0);

            		}).fail(function (jqXHR, statusText, error) {
						ajaxBookpics.push("");               //Hier könnte man den Pfad zu einem "default" Arikelbild reingeben.
                		console.log('Response Code: ' + jqXHR.status + ' - Fehlermeldung: ' + jqXHR.responseText);
                		$('#output').html('Ein Fehler ist aufgetreten');
            		});
				}	
			}


	
			function ajax_safeAuthorToBooks(Books_Json){
				for (i = 0; i <= Books_Json.length-1; i++) {
					obj = Books_Json[i];
					$.ajax({
               			url: 'http://localhost:8000/web2/autor/gib/' + obj.authorid ,
                		method: 'get',
                		dataType: 'json'
            		}).done(function (response) {

						ajax_safeAdditionalData(response,1);

            		}).fail(function (jqXHR, statusText, error) {
						ajaxAuthors.push("");                      //  Was tun wenn loadbyid für Bewerungen failed?
                		console.log('Response Code: ' + jqXHR.status + ' - Fehlermeldung: ' + jqXHR.responseText);
                		$('#output').html('Ein Fehler ist aufgetreten');
            		});
				}
			}
			

			

			function ajax_safeGenreToBooks(Books_Json){
				for (i = 0; i <= Books_Json.length-1; i++) {
					obj = Books_Json[i];
					$.ajax({
               			url: 'http://localhost:8000/web2/buchgenre/gib/' + obj.genreid ,
                		method: 'get',
                		dataType: 'json'
            		}).done(function (response) {
						console.log(response);
						ajax_safeAdditionalData(response,2);

            		}).fail(function (jqXHR, statusText, error) {
						ajaxGenres.push("");                      //  Was tun wenn loadbyid für Genre failed?
                		console.log('Response Code: ' + jqXHR.status + ' - Fehlermeldung: ' + jqXHR.responseText);
                		$('#output').html('Ein Fehler ist aufgetreten');
            		});
				}
			}

			
			
			


			function ajaxToHTML(){
				for (i = 0; i <= ajaxBooks.length-1; i++) {
					tmp="";

					console.log(ajaxGenres);

					bookobj = ajaxBooks[i];
					bildobj = ajaxBookpics[i];
					authorobj = ajaxAuthors[i];
					genreobj = ajaxGenres[i];
			
					tmp += "<div class=\"artikel_buble\"><a href=\"Artikelseite.html?titelID=";       
					tmp += bookobj.id + "\">";
					tmp += "<img class=\"artikel_img_container\" src=\""
			   		tmp += bildobj.bildpfad;
					tmp += "\"></img>";
					tmp += "<div class=\"artikel_text_container\"> <p> "
					tmp += "<span class=\"Price_attribute\">"  +  bookobj.preis +   "&euro;</span> <br><br>";
					tmp += "<span class=\"Author_attribute_tag\">Titel:</span><br>";
					tmp += "<span class=\"Author_attribute\">" + bookobj.titel +  ":</span> <br><br> ";
					tmp += "<span class=\" Author_attribute_tag \">Author:</span><br>" + authorobj.name + "<br></span> <br>";
					tmp += "<span class=\"Author_attribute_tag\">Genre:</span><br>  <span class=\"Author_attribute\"> "+ genreobj.bezeichnung + "</span><br><br>";
					tmp += "<span class=\"Author_attribute_tag\">Bewertung:</span> (" + bookobj.anzahlbew +  ") <span>" + createStars(bookobj.gesamtbewertung) + "</span> ";
					// hier muss mit einer if abfrage wenn die Anzahl der Sterne geladen wurde dann entsprehend <span class="fa fa-star"></span> eingefügt werden.
					tmp += "</p></div></a></div>";
					$("#shop_container").append(tmp);
				}
			}




			// Hier vielelicht Parameter abfragen ob Filter gesetzt? Dann muss eigentlich nur url ändern?!
			$(document).ready(function() {

					
				var suche = getUrlParameterByName("search");
				var preis = getUrlParameterByName("price");

				if (suche!=null) {
					
					
					console.log(suche);
					$.ajax({
						url: 'http://localhost:8000/web2/shop/gib/suche/'+suche,
						method: 'get',
						dataType: 'json'
            		}).done(function (response) {
					
					ajax_safeAllBooks(response.daten);

            		}).fail(function (jqXHR, statusText, error) {
						console.log('Response Code: ' + jqXHR.status + ' - Fehlermeldung: ' + jqXHR.responseText);
						$('#output').html('Ein Fehler ist aufgetreten');
            		});

				}


				else if (preis!=null) {




					console.log(preis);
					
					
					$.ajax({
						url: 'http://localhost:8000/web2/shop/gib/preis/'+preis,
						method: 'get',
						dataType: 'json'
					}).done(function (response) {
					
						ajax_safeAllBooks(response.daten);

					}).fail(function (jqXHR, statusText, error) {
						console.log('Response Code: ' + jqXHR.status + ' - Fehlermeldung: ' + jqXHR.responseText);
						$('#output').html('Ein Fehler ist aufgetreten');
					});
				}

				else{

					console.log("Alle anzeigen");
					
					$.ajax({
						url: 'http://localhost:8000/web2/shop/gib/all',
						method: 'get',
						dataType: 'json'
            		}).done(function (response) {
					
					ajax_safeAllBooks(response.daten);

            		}).fail(function (jqXHR, statusText, error) {
						console.log('Response Code: ' + jqXHR.status + ' - Fehlermeldung: ' + jqXHR.responseText);
						$('#output').html('Ein Fehler ist aufgetreten');
            		});
					





					
					

				}

        	});





			/*$(document).ready(function() {

					
				var preis = getUrlParameterByName("price");
				
				if (preis!=null) {




					console.log(preis);
					
					
					$.ajax({
						url: 'http://localhost:8000/web2/shop/gib/preis/'+preis,
						method: 'get',
						dataType: 'json'
					}).done(function (response) {
					
						ajax_safeAllBooks(response.daten);

					}).fail(function (jqXHR, statusText, error) {
						console.log('Response Code: ' + jqXHR.status + ' - Fehlermeldung: ' + jqXHR.responseText);
						$('#output').html('Ein Fehler ist aufgetreten');
					});
				}

				else{



					console.log("Alle anzeigen");
					

					$.ajax({
						url: 'http://localhost:8000/web2/shop/gib/all',
						method: 'get',
						dataType: 'json'
					}).done(function (response) {
					
					ajax_safeAllBooks(response.daten);

					}).fail(function (jqXHR, statusText, error) {
						console.log('Response Code: ' + jqXHR.status + ' - Fehlermeldung: ' + jqXHR.responseText);
						$('#output').html('Ein Fehler ist aufgetreten');
					});
					
					

					

				}

				});*/



			

			
			function getUrlParameterByName(name,url)
			{
				if (!url) url = window.location.href;
					name = name.replace(/[\[\]]/g, "\\$&");
					var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"), results = regex.exec(url);
				if (!results) return null;

				if (!results[2]) return '';

				return decodeURIComponent(results[2].replace(/\+/g, " "));
			}



		</script>

    </body>
</html>