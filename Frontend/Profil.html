<html>
    <head>
        <title>The Ebook Hub</title>
        <link rel="stylesheet" href="sources/stylesheet.css"/>
        <link rel="stylesheet" href="CSS/profil.css"/>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
		<script src="JS/sessionHandling.js"></script>
        <meta charset="UTF-8"/>
    </head>
    
    <body>
        <div id="navigation">
            <div id="titel" class="navElemente">
                <a id="title_font" href="Home.html">The Ebook Hub</a>
            </div>

            <div id="selectNav" class="navElemente">              
                    <a href="Home.html">HOME</a>     
                    <a href="Shop.html">SHOP</a>   
                    <a href="AuthorPageUebersicht.html">AUTOREN</a>          
                    <a href="Profil.html">ACCOUNT</a>
                    <a href="Warenkorb.html">
                    <img id="warenkorb" src="sources/Warenkorb.png" alt="Warenkorb">
                    <span id="anzahl_bestellungen"></span>
                    </a>                 
            </div>

            <div id="logo"></div>
        </div>   
        
        <div id="main">
            <div id="headline_container">
                <h1 id="profil_headline">Profil</h1>
                <p>Gekaufte Bücher</p>
            </div>            
            <form class="searchbar_container">
				<input type="text" placeholder="Nach Titel, Autor oder ISBN suchen..." id="suche" name="search">
				<button type="submit" >	<i class="fa fa-search"> </i></button>
			</form>
            
            <div id="right_container">
                <!-- evtl Kategorien hinzufügen-->

                <div id="button_container">
                    <button class="buttons" id="abmelden_button" type="button">Abmelden</button>
                    <button class="buttons" id="delete_button" type="button">Profil löschen</button>
                </div>
            </div>
        </div>

        <div id="footer">
            <div id="selectFooter" class="FooterElemente">              
                <a href="Impressum.html">Impressum und Kontakt</a>     
                <a href="Datenschutzerklaerung.html">Datenschutz</a>   
                <a href="Widerrufsrecht.html">Widerrufsrecht</a>     
                <div id="copyright"></div>
            </div>
        </div>
    </body>

    <script>
        $(async () => {

            //Bücher vom User laden, User ID noch einfügen anstatt 1
            let response = await fetch("/web2/bestellposition/gib/userEntries");
            let ajaxBooks = await response.json();
            await ajaxToHTML(ajaxBooks.daten);

            //später überlegen Referenz auf einzelne Buttons --> click --> Id Übergabe



            $("#abmelden_button").click(async () => {
                console.log("CLICK!");
                let response = await fetch('/web2/logout');
                let logout_json = await response.json();

                
                if(response.status == 200 && logout_json.daten.logout=='true') {
                    //Logout succcesfull!
                    clearSession();
                    window.location.replace("http://127.0.0.1:8000/Login.html");

                }else if(response.status == 200 && logout_json.daten.logout=='false') {
                    console.log("Logout fehlgeschlagen!");
                }

            });

            await $("#delete_button").click(async () => {
                //Abmelden aufrufen und aus Datenbank löschen

                
                let response = await fetch("web2/user", {
                    method: "DELETE",
                    headers: {
                        "Content-Type": "application/json",
                    },
                });
                await session_termination();
            });            
        });
       
        //Download muss noch realisiert werden
        function ajaxToHTML(ajaxBooks) {
            for (let i=0; i<ajaxBooks.length; i++) {
                tmp = "<div class=\"container_book\">"
                tmp += "<div class=\"inside_container_book\">";
                tmp += "<span class=\"bezeichner\">" + ajaxBooks[i].Buch.titel + "</span>";
                tmp += "</div>";
                tmp += "<div class=\"inside_container_book\">";
                tmp += "<span class=\"bezeichner\">" + ajaxBooks[i].Buch.isbn + "</span>";
                tmp += "</div>";
                tmp += "<div class=\"inside_container_book\">";
                tmp += "<span class=\"bezeichner\">" + ajaxBooks[i].Buch.autor_name + "</span>";
                tmp += "</div>";
                tmp += "<a href=\"Artikelseite.html?titelID=" + ajaxBooks[i].Buch.id + "\"><button class=\"buttons2\" type=\"button\">Download</button></a>";
                tmp += "<a href=\"Bewertung.html?titelID=" + ajaxBooks[i].Buch.id + "\"><button class=\"buttons2\" type=\"button\">Bewerten</button></a>";
                tmp += "</div>";
                $("#main").append(tmp);
            }    
        }

        
    </script>
</html>