<html>
    <head>
        <title>The Ebook Hub</title>
        <link rel="stylesheet" href="sources/stylesheet.css"/>
        <link rel="stylesheet" href="CSS/registrieren.css"/>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
		<script src="JS/sessionHandling.js"></script>
        <meta charset="UTF-8"/>
    </head>
    
    <body>
        <div id="navigation">
            <div id="titel" class="navElemente">
                <a id="title_font" href="Home.html">The Ebook Hub</a>
            </div>

            <div id="selectNav" class="navElemente">              
                    <a href="Home.html">HOME</a>     
                    <a href="Shop.html">SHOP</a>   
                    <a href="AuthorPageUebersicht.html">AUTOREN</a>          
                    <a href="Profil.html">ACCOUNT</a>
                    <a href="Warenkorb.html">
                    <img id="warenkorb" src="sources/Warenkorb.png" alt="Warenkorb">
                    <span id="anzahl_bestellungen"></span>
                    </a>                 
            </div>

            <div id="logo"></div>
        </div>   
        
        <div id="main">
            <div id="outer_login">
                <div id="inner_login">
                    <p id="page_titel">Registrieren:</p>
                    <p>Email:</p>
                    <form method="post" action="\Registrieren.html" id="registrieren_form">
                        <input type="email" name="email" placeholder="mustermann@gmail.com" id="email">
                    
                    <p>Passwort:</p>
                    
                        <input type="password" name="password1" placeholder="****************" id="passwort">
                    
                    <p>Passwort wiederholen:</p>
            
                        <input type="password" name="password2" placeholder="****************" id="passwort_pruefen">
                        <p><button id="registrieren_button" type="button">Registrieren</button></p>

                        <div style="height: 10px;">
                            <p id="register_status" style="display:none; color: red;">Registrieren Fehlgeschlagen! Bitte überprüfen sie ihre Eingabe</p>
                        </div>



                    </form>
                    <p style="margin-top: 30px;" id="login_container"><a id="zum_login" href="Login.html">Haben Sie bereits ein Konto? Hier zum Login.</a></p>
                    


                </div>
            </div>             
        </div>

        <div id="footer">
            <a href="Impressum.html">Impressum und Kontakt</a>     
            <a href="Datenschutzerklaerung.html">Datenschutz</a>   
            <a href="Widerrufsrecht.html">Widerrufsrecht</a>     
            <div id="copyright"></div>
        </div>

        <script>
            $(async() => {                
                await loadWarenkorb();


                $("#registrieren_button").click(async() => {
                    const emailInput = $("#email");
                    const pwInput = $("#passwort");
                    const pw_pruefenInput = $("#passwort_pruefen");

                    //evtl bezeichner anpassen
                    const newUser = {
                        email: emailInput.val(),
                        pw: pwInput.val(),
                        pw_pruefen: pw_pruefenInput.val(),
                    };
                    

                    let response = await fetch("web2/Registrieren.html", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json",
                        },
                        body: JSON.stringify(newUser),
                    });

                    let register_json = await response.json();


                    if(response.status == 200 && register_json.daten.register=='true') {
                        //Login succcesfull!
                        window.location.replace("http://127.0.0.1:8000/login.html");

                    }else if(response.status == 200 && register_json.daten.register=='false') {
                        //Register failed!
                
                        document.getElementById("register_status").style.display="block";
                    }
                    
                    
                    emailInput.val('');
                    pwInput.val('');
                    pw_pruefenInput.val('');

                    
                
                });
                
            });

            

            
            
          

            function ueberpruefePasswort(pw, pw_pruefen) {
                if (pw === pw_pruefen) {
                    return true;
                }else {
                    return false;
                }
            }
        </script>
    </body>
</html>